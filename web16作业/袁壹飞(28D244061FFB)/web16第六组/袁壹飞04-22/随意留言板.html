<!DOCTYPE html>
<html>

	<head>

		<meta charset="UTF-8">
		<script type="text/javascript" src="js/jquery-3.4.0.min.js"></script>
		<title>随意留言板</title>
		<link href="css/iconfont.css" rel="stylesheet" />
		<link href="css/main_css.css" rel="stylesheet" />
	</head>

	<body>

		<div class="main_box">
			<!--头部-->
			<div class="top_box">
				<div>
					<span class="iconfont icon-liuyan"></span>
					<h1>随意</h1>
					<span>留言</span>
				</div>
				<div>随意留言板功能强大漂亮美观大方,一起加入我们吧！</div>
			</div>
			<!--banner-->
			<div class="banner_box">
				<img src="img/banner.jpg" />
			</div>
			<!--导航栏切换-->
			<div class="nav_box">
				<span>我的留言</span>
			</div>

			<!--留言内容列表-->
			<div class="content_box">
				<!--具体的一项留言-->
				<div class="content_item">
					<div class="item_left">
						<div class="img">
							<img src="img/top01.jpg" />
						</div>
						<div>昵称：<label>晓菲</label></div>
					</div>

					<div class="item_right">
						<p>
							<span>
								<label>留言标题：</label>
								<label title="加强对五四运动和五四精神的研究">加强对五四运动和五四精神的研究</label>
							</span>
							<span>发表于：2019-04-19 10:20</span>
						</p>
						<p>
							男女的区别;女人胖是丰满，瘦是苗条，高是修长，矮是秀气。男人胖是肥猪，瘦是排骨，高是竹竿，矮是冬瓜!
						</p>
						<p>
							<span class="iconfont icon-11_zhiding"></span>
							<span class="iconfont icon-zuanshi"></span>
							<span class="iconfont icon-qq-copy"></span>
							<span class="iconfont icon-shanchu"></span>
							<span class="iconfont icon-pinglun"></span>
						</p>
							<!--回复信息-->
						<div class="back_box">
							<p>
								<input type="text" name="black_input" placeholder="想对作者说点什么"/>
								<button class="black_btn" type="button">发表评论</button>
							</p>
							<p>
								<span>1楼：</span><span>你好！</span>
							</p>
						</div>
					</div>
					
					
					
				</div>

				<div class="content_item">
					<div class="item_left">
						<div class="img">
							<img src="img/top02.jpg" />
						</div>
						<div>昵称：<label>灵采风</label></div>
					</div>

					<div class="item_right">
						<p>
							<span><label>留言标题：</label><label title="中国长三甲系列运载火箭跨入百次发射俱乐部">中国长三甲系列运载火箭跨入"百次发射俱乐部"</label></span>
							<span>发表于：2019-04-19 10:20</span>
						</p>
						<p>
							一个傻傻的男孩终于鼓起勇气和她喜欢的女孩说话：你喜欢什么样的男孩啊？女孩想了想说：投缘的吧。男孩听了很难过憋了半天说：非得头圆啊。
						</p>
						<p>
							<span class="iconfont icon-11_zhiding"></span>
							<span class="iconfont icon-zuanshi"></span>
							<span class="iconfont icon-qq-copy"></span>
							<span class="iconfont icon-shanchu"></span>
							<span class="iconfont icon-pinglun"></span>
						</p>
							<!--回复信息-->
						<div class="back_box">
							<p>
								<input type="text" name="black_input" placeholder="想对作者说点什么"/>
								<button class="black_btn" type="button">发表评论</button>
							</p>
							<p>
								<span>1楼：</span><span>你好！</span>
							</p>
						</div>
					</div>
				</div>
				<div class="content_item">
					<div class="item_left">
						<div class="img">
							<img src="img/top03.jpg" />
						</div>
						<div>昵称：<label>世外高人</label></div>
					</div>

					<div class="item_right">
						<p>
							<span><label>留言标题：</label><label title="绿水青山论坛在从化召开，珠三角将建全国第一个国">绿水青山论坛在从化召开，珠三角将建全国第一个国</label></span>
							<span>发表于：2019-04-19 10:20</span>
						</p>
						<p>
							人与人间的信任，就像是纸片，一旦破损，就不会再回到原来的样子。
						</p>
						<p>
							<span class="iconfont icon-11_zhiding"></span>
							<span class="iconfont icon-zuanshi"></span>
							<span class="iconfont icon-qq-copy"></span>
							<span class="iconfont icon-shanchu"></span>
							<span class="iconfont icon-pinglun"></span>
						</p>
							<!--回复信息-->
						<div class="back_box">
							<p>
								<input type="text" name="black_input" placeholder="想对作者说点什么"/>
								<button class="black_btn" type="button">发表评论</button>
							</p>
							
						</div>
					</div>
				</div>
				<div class="content_item">
					<div class="item_left">
						<div class="img">
							<img src="img/top04.jpg" />
						</div>
						<div>昵称：<label>小盆友</label></div>
					</div>

					<div class="item_right">
						<p>
							<span><label>留言标题：</label><label title="爱立信领衔Q2微波设备市场份额 华为诺基亚">爱立信领衔Q2微波设备市场份额 华为诺基亚</label></span>
							<span>发表于：2019-04-19 10:20</span>
						</p>
						<p>
							People cry, not because they\'re weak. It\'s because they\'ve been strong for too 
						</p>
						<p>
							<span class="iconfont icon-11_zhiding"></span>
							<span class="iconfont icon-zuanshi"></span>
							<span class="iconfont icon-qq-copy"></span>
							<span class="iconfont icon-shanchu"></span>
							<span class="iconfont icon-pinglun"></span>
						</p>
							<!--回复信息-->
						<div class="back_box">
							<p>
								<input type="text" name="black_input" placeholder="想对作者说点什么"/>
								<button class="black_btn" type="button">发表评论</button>
							</p>
						</div>
					</div>
				</div>

			</div>

			<!--发表留言-->
			<div class="message_box">
				<div>
					<span class="iconfont icon-liuyan"></span>
					<div>
						<p>在线留言</p>
						<p>说出你的心声，让全世界的小伙伴聆听你的心声！</p>
					</div>
				</div>

				<!--发送内容-->
				<div class="footer_box">
					<div class="send_message_box">
						<div>
							<span>昵称</span>
							<input type="text" name="uesrname" />
						</div>
						<div>
							<span>留言标题</span>
							<input type="text" name="msgTitle" />
						</div>
						<div>
							<span>你的心声</span>
							<textarea name="msgContent"></textarea>
						</div>
						<div>
							<!--icon-fasong-->
							<span class="iconfont  send_msg_btn">发送&#xe642;</span>
						</div>

					</div>

					<!--头像选择-->
					<div class="top_content_box">
						<p>选择你的头像</p>
						<div>
							<img class="top_img" src="img/top01.jpg" />
						</div>
						<!--头像选择-->
						<ul class="top_img_ul">
							<li>
								<img src="img/top01.jpg" />
							</li>
							<li>
								<img src="img/top02.jpg" />
							</li>
							<li>
								<img src="img/top03.jpg" />
							</li>
							<li>
								<img src="img/top04.jpg" />
							</li>
							<li>
								<img src="img/top05.jpg" />
							</li>
						</ul>
					</div>

				</div>

			</div>

			<!--错误提示信息-->
			<div class="error_box">输入的内容不能为空！</div>
			
			<!--留言按钮-->
			<div class="liuyan_btn">写留言</div>
			
			<!--删除提示-->
			<div class="del_box">
				<div>
					<p>确认要删除该项留言吗？</p>
					<p>
						<button class="delTrue">确认</button>
						<button class="delFalse">取消</button>
					</p>
				</div>
			</div>
		</div>
	</body>

</html>

<script>
	//页面完成加载
	$(function() {

		//给发送按钮绑定点击事件
		$('.send_msg_btn').click(function() {
			//得到输入框中的内容
			var username = $('input[name="uesrname"]').val().trim();
			var title = $('input[name="msgTitle"]').val().trim();
			var textContent = $('textarea').val().trim();
			var currentDate = getCurrentDate();
			//非空判断
			if(!username || !title || !textContent) {
				//显示错误提示信息
				
				alertMsg('亲,请输入完整的信息哦！');
				return;
			}
			//准备数据

			var newItem = '<div class="content_item"><div class="item_left"><div class="img"><img src="'+$('.top_img').attr('src')+'" /></div><div>昵称：<label>'+username+'</label></div></div>'
							+'<div class="item_right"><p><span><label>留言标题：</label><label title="'+title+'">'+title+'</label></span><span>发表于：'+currentDate+'</span></p><p>'+textContent+'</p>'
							+'<p><span class="iconfont icon-11_zhiding"></span><span class="iconfont icon-zuanshi"></span><span class="iconfont icon-qq-copy"></span>'
							+'<span class="iconfont icon-shanchu"></span><span class="iconfont icon-pinglun"></span></p>'
							+'<div class="back_box"><p><input type="text" name="black_input" placeholder="想对作者说点什么"/> <button class="black_btn" type="button">发表评论</button></p></div>'
							+'</div></div>';
			//添加到留言列表中
			$('.content_box').prepend(newItem);
		
			alertMsg('亲,留言成功了哦！');
			//清空输入框
			 $('input[name="uesrname"]').val("");
			$('input[name="msgTitle"]').val("");
			 $('textarea').val("");
			 //重新绑定事件 sendMsgFn  black_btn
//			 var oNew = $('.icon-11_zhiding').first();
			 $('.icon-11_zhiding').first().click(toFirstItem);//置顶
			 $('.icon-shanchu').first().click(delItemFn); //删除
			 $('.icon-pinglun').first().click(togglePinluFn); //评论
			 $('.black_btn').first().click(sendMsgFn); //发送评论
			 
		});

		//给图片设置点击事件
		var state = false;
		$('.top_img').click(function() {
			state = !state;
			if(state){
				//展开头像列表
				$('.top_img_ul').animate({
					right: '190px',
					opacity: 1
				}, 1000)
			}else{
				//隐藏头像列表
				$('.top_img_ul').animate({
					right: '-570px',
					opacity: 0
				}, 1000)
			}
		
		});
		
		//给每一个头像绑定点击事件
		$('.top_img_ul>li>img').click(function(){
			state = false;
			//设置相应的头像图片
			$('.top_img').attr('src',$(this).attr('src'));
			//隐藏头像列表
			$('.top_img_ul').animate({
				right: '-570px',
				opacity: 0
			}, 1000);
		
		});
		
		//给window绑定滚动条事件
		$(window).scroll(function(){
			//当留言板不在当前窗口的可视区域时显示写留言按钮
			var currentTop = $('.message_box')[0].getBoundingClientRect().top;
			if(currentTop > $(window).innerHeight()){
				$('.liuyan_btn').fadeIn(1000);
			}else{
				$('.liuyan_btn').fadeOut(1000);
			}
		});
		
		//给写留言按钮绑定点击事件
		$('.liuyan_btn').click(function(){
			//显示写留言的
			var currentTop = $('.message_box')[0].getBoundingClientRect().bottom;
			$(window).scrollTop(currentTop);
			
		});
		
//		===========留言列表项的功能========
		//置顶功能 
		$('.icon-11_zhiding').click(toFirstItem);
		function toFirstItem(){

			var currentToFirst = $(this).parent().parent().parent()[0];
			//如果是第一个，则不能再置顶了
			if(currentToFirst == $('.content_item').first()[0]){
				//提示不能再置顶
				//显示错误提示信息
				alertMsg('亲,已经是顶部了哦!');
				return;
			}
			//实现置顶
			$('.content_item').first().before($(currentToFirst));
		}
		
		//删除功能
		$('.icon-shanchu').click(delItemFn);
		
		function delItemFn(){
			var currentToRemove = $(this).parent().parent().parent();
			//删除提示
			$('.del_box').css('display','block');
			$('.del_box>div').animate({top:'0'},500);
			//给取消按钮绑定点击事件
			$('.delFalse').click(function(){
				$('.del_box>div').animate({top:'-180px'},500);
				$('.del_box').fadeOut(500)
			});
			$('.delTrue').click(function(){
				//删除留言
				currentToRemove.remove();
				$('.del_box>div').animate({top:'-180px'},500);
				$('.del_box').fadeOut(500)
			});
		}
		
		//=====发表评论===
		//给显示评论按钮绑定事件slideToggle
		$('.icon-pinglun').click(togglePinluFn);
		function togglePinluFn(){
			$(this).parent().next().slideToggle(500);
		}
		
		//给发表的按钮绑定点击事件
		$('.black_btn').click(sendMsgFn);
		
		function sendMsgFn(){
			//获取对应输入框的信息
			var text = $(this).prev().val().trim();
			if(!text){
				//非空判断
				alertMsg('难道没有心动的一刻吗?');
				return ;
			}
			//发表评论
			//计算楼层
			
			var oP = $(this).parent().parent().children();
			var count = 0;
			if(oP.length == 1){
				count = 1;
			}else{
				count = parseInt(oP.eq(oP.length-1).children().eq(0).html())+1;
			}
		
		
			$(this).parent().parent().append('<p><span>'+count+'楼：</span><span>'+text+'</span></p>');
			//清空输入框
			 $(this).prev().val("");
		}
		
	//============================end====
	});
	
	//信息提示函数
	function alertMsg(msg){
		$('.error_box').html(msg);
		$('.error_box').fadeIn(1000);
		$('.error_box').fadeOut(1000);
	}
	//得到时间的函数
	function getCurrentDate(){
		var nowTime = new Date();
		
		return nowTime.getFullYear()+"-"+(nowTime.getMonth()+1 < 10?"0"+(nowTime.getMonth()+1):nowTime.getMonth()+1)+"-"
						+(nowTime.getDate()<10 ? "0"+nowTime.getDate():nowTime.getDate())
						+"  "+(nowTime.getHours() < 10? "0"+nowTime.getHours():nowTime.getHours())+":"+(nowTime.getMinutes() < 10 ? "0"+nowTime.getMinutes():nowTime.getMinutes());
	}
</script>